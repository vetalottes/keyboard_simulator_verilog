# keyboard_simulator_verilog

Для работы клавиатуры по протоколу PS/2 нужно два модуля - ресивер (RECIEVER_pc2) и дешифратор (DC_pc2). Они связаны между собой тем, что модуль ресивер считывает входные
сигналы с клавиатуры и объединяет их в пакет данных PS/2 recieved_data, который впоследствии будет расшифрован дешифратором, в зависимости от входного значения pc2-data
(из предыдущего модуля ps2_reciever) при помощи оператора множественного выбора case, где описаны коды клавиш.
Ресивер работает по заднему фронту синхросигнала с клавиатуры PC2_CLK и реализован с помощью блока always и оператора множественного выбора case: нулевое состояние state
сбрасывает сигнал готовности считывания данных ready_output R_O в ноль, передается стартовый бит, далее в состояниях 1-8 следует запись самих битов данных: в регистр
результата received_data заносятся соответствующие входные данные с клавиатуры r. Состояние 9 отведено для бита четности количества единичных битов, используемого для
проверки корректности полученных данных. Последний бит является стоповым единичным битом. Если пакет передался некорректно, то необходимо вернуться в нулевое состояние.
Если ошибок выявлено не было, на R_O подается единица.
Регистр fsm_data модуля дешифратора содержит коды клавиш, необходимые в дальнейшем для автомата FSM, для сравнения символов через код клавиш, за исключением клавиши
подтверждения s_key и клавиш сброса. На выход модуля также подаются сигналы set_signal и reset_signal, которые принимают значение единицы в том случае, если код нажатой
клавиши совпадает с указанными кодами сброса r_key, re_key в параметрах модуля и если есть ненулевой разрешающий сигнал pc2_ro. 


Для отображения информации на мониторе необходим интерфейс VGA. Сигнал формата VGA представляет собой компонентный сигнал RGBHV (сигнал RGB + синхронизация «по
горизонтали» + синхронизация «по вертикали»). Потребуется 4 модуля: модуль синхронизатора vga, модуль делителя частоты CLK_DIV, модуль формирования
изображения\символов chars с помощью 1 и 0 и управляющий модуль top_vga. В синхронизаторе vga все направлено на то, чтобы соответствовало правильному формированию
кадра, горизонтальной и вертикальной синхронизации, согласно Рисунку vga_signal. Частота пикселей pixel clock выбранного для проекта VGA интерфейса равняется 50 МГц,
поэтому требуется делитель частоты — один из вариантов использования счётчика. На вход clk подаётся сигнал тактового генератора, на выход — новая частота new_clk,
которая задействована в модуле vga в качестве входа clk50. В данном модуле организован регистр, который увеличивается на единицу при каждом восходящем фронте clk.
Модуль top_vga координирует работу трех описанных выше модулей (vga, chars, div_clk) для вывода изображения на монитор по протоколу VGA.


В основе разрабатываемого проекта клавиатурного тренажера лежит сравнение двух символов: эталонного символа тренажера, который должен отображаться на дисплее, и
нажатого пользователем символа клавиатуры.
Нулевое состояние автомата производит присвоение значению регистра need_symbol кода «нереального» эталонного, равного коду символа включения клавиатурного тренажера
«Enter», чтобы запустить последовательность эталонных кодов.
Первое состояние по сути — начало работы автомата, так как в блоке инициализации обнуляется значение регистра res_out и именно это состояние указано как начальное.
Если в качестве входных данных пришел код клавиши «Enter» или неизвестной клавиши (code равняется 0), то переход в 0 состояние, иначе переход во 2 состояние.
Второе состояние — сравнение пришедшего с клавиатуры кода клавиши code с эталонным need_symbol. Здесь три варианта:
1. Код нажатой клавиши равен эталонному коду запуска клавиатурного тренажера. Тогда код первого эталонного значения (символ «S» с кодом «1B») записывается в регистр
результата res_code. Переход в 5 состояние.
2. Код нажатой клавиши равен эталонному, с условием, что код эталонного — не код символа запуска клавиатурного тренажера. Переход в 3 состояние.
3. Код нажатой клавиши не равен эталонному. Происходит присвоение значению регистра res_out единицы. Переход в 4 состояние.

В третьем состоянии посредством оператора множественного выбора case обновляется значение эталонного кода need_symbol. Переход в 4 состояние.
Четвертое состояние заносит данные need_symbol в выходной регистр res_code, если code не является кодом клавиши «Enter», иначе совершается присвоение need_symbol
значения первого эталонного кода «1B». Ожидание сигнала set_signal для перехода в 1 состояние.

Подробности в файле pdf.
